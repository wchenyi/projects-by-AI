<!DOCTYPE html>
<html lang="zh-CN" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用商店</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .backdrop-blur-lg { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }
        html.dark ::-webkit-scrollbar-thumb { background: #a0aec0; }
        #app-detail-modal.hidden { display: none; }
        .grid-auto-fit { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        
        /* 关键：确保所有卡片内的图标大小统一且不变形 */
        .app-icon-large { width: 4.5rem; height: 4.5rem; object-fit: contain; } /* 72px */
        .app-icon-medium { width: 4rem; height: 4rem; object-fit: contain; } /* 64px */
        .app-icon-small { width: 3rem; height: 3rem; object-fit: contain; } /* 48px */
        .modal-app-icon { width: 5rem; height: 5rem; object-fit: contain; } /* 80px */
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="flex h-screen overflow-hidden">
        <!-- 侧边栏 -->
        <aside id="sidebar" class="w-64 bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg p-4 flex-col flex-shrink-0 fixed lg:relative h-full z-20 -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="flex items-center gap-3 mb-8">
                <svg class="w-8 h-8 text-blue-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12L22 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <h1 class="text-xl font-bold">应用商店</h1>
            </div>
            <nav id="category-nav" class="flex-1 space-y-2">
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase">分类</p>
                <!-- 分类导航会由JS动态生成 -->
            </nav>
        </aside>

        <!-- 主内容区 -->
        <div class="flex-1 flex flex-col overflow-auto">
            <!-- 顶部栏 -->
            <header class="sticky top-0 z-10 bg-gray-100/80 dark:bg-gray-900/80 backdrop-blur-lg flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-4">
                    <button id="menu-toggle" class="lg:hidden p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <div class="relative hidden sm:block"><input type="text" id="search-input" placeholder="搜索应用、游戏等" class="w-48 md:w-64 lg:w-96 bg-gray-200 dark:bg-gray-800 border border-transparent focus:ring-2 focus:ring-blue-500 focus:border-transparent rounded-lg py-2 pl-10 pr-4 transition"><svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg id="theme-icon-light" class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.92999 4.92999L6.34999 6.34999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.65 17.65L19.07 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 12H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.92999 19.07L6.34999 17.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.65 6.34999L19.07 4.92999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg id="theme-icon-dark" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.75C5.79522 2.75 2.75 5.79522 2.75 12C2.75 18.2048 5.79522 21.25 12 21.25C16.8375 21.25 20.5005 18.2625 21.125 13.5C15.825 14.125 10.125 9.0875 10.5 3.5C11.0875 3.05 11.525 2.75 12 2.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <img src="https://placehold.co/40x40/6366f1/ffffff?text=U" alt="用户头像" class="w-10 h-10 rounded-full">
                </div>
            </header>

            <!-- 滚动内容区 -->
            <main id="main-content" class="p-4 sm:p-6 lg:p-8 space-y-8">
                <div class="text-center py-16">
                    <p class="text-gray-500">正在加载应用...</p>
                </div>
            </main>
        </div>
    </div>

    <!-- 应用详情 Modal -->
    <div id="app-detail-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="modal-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div id="modal-content" class="relative z-40 w-full max-w-4xl max-h-[90vh] bg-gray-100/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-transform duration-300 scale-95 opacity-0">
            <div class="flex-shrink-0 p-6 flex justify-between items-start border-b border-gray-300 dark:border-gray-700">
                <div class="flex items-start gap-5">
                    <img id="modal-app-icon" src="" alt="App Icon" class="modal-app-icon rounded-xl shadow-md flex-shrink-0">
                    <div>
                        <h2 id="modal-app-name" class="text-3xl font-bold"></h2>
                        <div class="flex items-center gap-2 mt-2 text-yellow-400">
                            <span id="modal-app-rating" class="text-lg font-bold text-gray-800 dark:text-gray-200"></span>
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/></svg>
                        </div>
                        <p id="modal-app-platform" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
                    </div>
                </div>
                <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <div><h3 class="font-bold text-lg mb-2">简介</h3><p id="modal-app-desc" class="text-gray-600 dark:text-gray-300"></p></div>
                <div><h3 class="font-bold text-lg mb-3">特色介绍</h3><div id="modal-app-features" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div></div>
            </div>
            <div class="flex-shrink-0 p-6 border-t border-gray-300 dark:border-gray-700 bg-white/30 dark:bg-gray-900/30 flex flex-col sm:flex-row items-center gap-4">
                <button class="w-full sm:w-auto flex-1 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-all duration-200 shadow-lg hover:shadow-blue-500/50 transform hover:-translate-y-0.5">官方下载</button>
                <button class="w-full sm:w-auto flex-1 bg-gray-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-700 transition-all duration-200">备用链接</button>
            </div>
        </div>
    </div>

    <script type="module">
        // ===================================================================================
        // 主应用逻辑 (最终版 - 动态加载数据)
        // ===================================================================================
        document.addEventListener('DOMContentLoaded', async () => {
            const mainContent = document.getElementById('main-content');
            const categoryNav = document.getElementById('category-nav');
            const searchInput = document.getElementById('search-input');
            
            let allAppsData = {}; // 存储从文件加载的所有应用数据
            let allAppsList = []; // 扁平化的应用列表，用于搜索
            let currentCategory = 'windows'; // 默认显示的分类

            // 定义分类信息，程序将根据这个配置加载对应文件
            const categories = [
                { id: 'windows', name: 'PC端', file: './apps/windows/data.js', dataKey: 'windowsApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5C4 4.44772 4.44772 4 5 4H19C19.5523 4 20 4.44772 20 5V15C20 15.5523 19.5523 16 19 16H5C4.44772 16 4 15.5523 4 15V5Z" stroke="currentColor" stroke-width="2"/><path d="M12 16V20M12 20H15M12 20H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'apple', name: '苹果端', file: './apps/apple/data.js', dataKey: 'appleApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.5001 19.5C11.2147 19.5001 9.96223 19.1145 8.88281 18.3916C7.66085 17.575 6.75338 16.3575 6.32001 14.94C5.22001 15.04 4.16001 14.33 3.68001 13.33C3.20001 12.33 3.39001 11.17 4.17001 10.42C4.1239 9.86311 4.21922 9.29943 4.44853 8.78418C4.67784 8.26892 5.03462 7.82143 5.48001 7.49C5.97001 6.66 6.75001 6.06 7.68001 5.79C8.21001 4.96 9.01001 4.35 9.95001 4.07C10.89 3.79 11.9 3.86 12.83 4.26C13.76 4.66 14.56 5.37 15.08 6.26C15.8233 6.13112 16.582 6.25735 17.24 6.62C18.19 7.15 18.82 8.11 18.94 9.2C19.8495 9.40794 20.5925 10.053 20.94 10.94C21.2875 11.827 21.2101 12.8349 20.73 13.67C20.25 14.5051 19.4187 15.0713 18.5 15.2C18.5 16.71 17.8 18.16 16.61 19.07C15.42 19.98 13.9701 20.24 12.6001 19.99" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 4C11.41 4.41 11.03 5.05 10.96 5.75" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'android', name: '安卓端', file: './apps/android/data.js', dataKey: 'androidApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 8.5C15.5 9.32843 14.8284 10 14 10C13.1716 10 12.5 9.32843 12.5 8.5C12.5 7.67157 13.1716 7 14 7C14.8284 7 15.5 7.67157 15.5 8.5ZM10.5 8.5C10.5 9.32843 9.82843 10 9 10C8.17157 10 7.5 9.32843 7.5 8.5C7.5 7.67157 8.17157 7 9 7C9.82843 7 10.5 7.67157 10.5 8.5ZM18 13C18 13.5523 17.5523 14 17 14H7C6.44772 14 6 13.5523 6 13C6 12.4477 6.44772 12 7 12H17C17.5523 12 18 12.4477 18 13ZM20 5.5L18.7941 4.29412C18.3922 3.89216 17.7598 3.82353 17.2941 4.11765L16 5V3H8L6.70588 4.11765C6.2402 3.82353 5.60784 3.89216 5.20588 4.29412L4 5.5V18C4 19.6569 5.34314 21 7 21H17C18.6569 21 20 19.6569 20 18V5.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'linux', name: 'Linux', file: './apps/linux/data.js', dataKey: 'linuxApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21C12 21 15 18.5 15 15C15 11.6863 12 11 12 6C12 11 9 11.6863 9 15C9 18.5 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 6C12 3.79086 10.2091 2 8 2C5.79086 2 4 3.79086 4 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 15C15 15 16.5 16 17 17C18.5 19.5 15 22 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 15C9 15 7.5 16 7 17C5.5 19.5 9 22 12 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'other', name: '其他', file: './apps/other/data.js', dataKey: 'otherApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12ZM6 12C7.10457 12 8 11.1046 8 10C8 8.89543 7.10457 8 6 8C4.89543 8 4 8.89543 4 10C4 11.1046 4.89543 12 6 12ZM18 12C19.1046 12 20 11.1046 20 10C20 8.89543 19.1046 8 18 8C16.8954 8 16 8.89543 16 10C16 11.1046 16.8954 12 18 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
            ];

            // --- 核心数据加载函数 ---
            const loadAllData = async () => {
                const dataPromises = categories.map(cat => 
                    import(cat.file)
                        .then(module => ({ id: cat.id, data: module[cat.dataKey] || [] }))
                        .catch(error => {
                            console.warn(`无法加载分类 "${cat.name}" 的数据文件: ${cat.file}`, error);
                            return { id: cat.id, data: [] }; // 如果文件不存在或出错，返回空数组
                        })
                );
                
                const results = await Promise.all(dataPromises);
                
                results.forEach(result => {
                    allAppsData[result.id] = result.data;
                    allAppsList.push(...result.data);
                });
            };

            // --- 动态渲染函数 ---
            const renderApps = (apps) => {
                mainContent.innerHTML = ''; // 清空当前内容
                if (!apps || apps.length === 0) {
                    mainContent.innerHTML = `<div class="text-center py-16"><p class="text-gray-500">这个分类下还没有应用，请检查对应的 data.js 文件是否已创建并包含内容。</p></div>`;
                    return;
                }
                
                // 排序：large > medium > small
                apps.sort((a, b) => {
                    const sizes = { 'large': 3, 'medium': 2, 'small': 1 };
                    return (sizes[b.size] || 1) - (sizes[a.size] || 1);
                });

                const appGrid = document.createElement('div');
                appGrid.className = 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4';
                
                apps.forEach(app => {
                    const card = createAppCard(app);
                    appGrid.appendChild(card);
                });
                mainContent.appendChild(appGrid);
            };

            const createAppCard = (app) => {
                const card = document.createElement('div');
                card.className = 'app-card group cursor-pointer transition-all duration-300';
                
                let typeBadge = '';
                if (app.type) {
                    const isDesktop = app.type.toLowerCase() === 'desktop';
                    const badgeColor = isDesktop ? 'bg-sky-500' : 'bg-green-500';
                    const badgeText = isDesktop ? '桌面' : '移动';
                    typeBadge = `<span class="absolute top-2 right-2 text-xs font-semibold text-white ${badgeColor} px-2 py-0.5 rounded-full z-10">${badgeText}</span>`;
                }

                const size = app.size || 'small';
                if (size === 'large') {
                    card.classList.add('col-span-2', 'row-span-2', 'rounded-2xl', 'overflow-hidden', 'relative', 'shadow-lg', 'hover:shadow-2xl');
                    card.innerHTML = `
                        <img src="https://images.unsplash.com/photo-1557682250-33bd709cbe85?q=80&w=2670&auto=format&fit=crop" alt="${app.name} 背景" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                        <div class="absolute bottom-0 left-0 p-4 text-white">
                            <img src="${app.icon}" alt="${app.name} 图标" class="w-12 h-12 mb-2 rounded-lg bg-white p-1 object-contain">
                            <h4 class="font-bold text-lg">${app.name}</h4>
                            <p class="text-sm text-gray-300">${app.category}</p>
                        </div>
                        ${typeBadge}
                    `;
                } else if (size === 'medium') {
                    card.classList.add('col-span-2', 'rounded-2xl', 'bg-white', 'dark:bg-gray-800', 'p-4', 'flex', 'items-center', 'gap-4', 'shadow-md', 'hover:shadow-xl', 'hover:-translate-y-1', 'relative');
                    card.innerHTML = `
                        <img src="${app.icon}" alt="${app.name} 图标" class="app-icon-medium rounded-lg flex-shrink-0">
                        <div class="overflow-hidden">
                            <h4 class="font-semibold truncate">${app.name}</h4>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${app.category}</p>
                        </div>
                        ${typeBadge}
                    `;
                } else { // small
                    card.classList.add('rounded-2xl', 'bg-white', 'dark:bg-gray-800', 'p-4', 'flex', 'flex-col', 'items-center', 'justify-center', 'text-center', 'shadow-md', 'hover:shadow-xl', 'hover:-translate-y-1', 'relative');
                    card.innerHTML = `
                        <img src="${app.icon}" alt="${app.name} 图标" class="app-icon-small mb-3">
                        <h4 class="font-semibold w-full truncate">${app.name}</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${app.category}</p>
                        ${typeBadge}
                    `;
                }

                Object.keys(app).forEach(key => {
                    if (key === 'features') card.dataset[key] = app[key].join('|');
                    else card.dataset[key] = app[key];
                });
                card.addEventListener('click', () => openModal(card));
                return card;
            };
            
            const renderNav = () => {
                categories.forEach(cat => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.dataset.category = cat.id;
                    link.className = 'nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors';
                    link.innerHTML = `${cat.icon}<span>${cat.name}</span>`;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentCategory = cat.id;
                        searchInput.value = ''; // 清空搜索框
                        renderApps(allAppsData[currentCategory]);
                        updateNavActiveState();
                    });
                    categoryNav.appendChild(link);
                });
            };

            const updateNavActiveState = () => {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('text-white', 'bg-blue-500', 'font-semibold', 'shadow');
                    link.classList.add('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    if (link.dataset.category === currentCategory) {
                        link.classList.add('text-white', 'bg-blue-500', 'font-semibold', 'shadow');
                        link.classList.remove('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    }
                });
            };

            // --- 搜索功能 ---
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length > 0) {
                    const filteredApps = allAppsList.filter(app => 
                        app.name.toLowerCase().includes(searchTerm) || 
                        app.category.toLowerCase().includes(searchTerm)
                    );
                    renderApps(filteredApps);
                } else {
                    // 如果清空搜索框，则返回当前选中的分类
                    renderApps(allAppsData[currentCategory]);
                }
            });

            // --- 初始化流程 ---
            renderNav();
            await loadAllData();
            renderApps(allAppsData[currentCategory]);
            updateNavActiveState();


            // --- Modal 逻辑 (无需修改) ---
            const modal = document.getElementById('app-detail-modal');
            const modalContent = document.getElementById('modal-content');
            const modalBackdrop = document.getElementById('modal-backdrop');
            const closeBtn = document.getElementById('modal-close-btn');
            const modalAppName = document.getElementById('modal-app-name');
            const modalAppIcon = document.getElementById('modal-app-icon');
            const modalAppRating = document.getElementById('modal-app-rating');
            const modalAppDesc = document.getElementById('modal-app-desc');
            const modalAppFeatures = document.getElementById('modal-app-features');
            const modalAppPlatform = document.getElementById('modal-app-platform');

            const openModal = (card) => {
                modalAppName.textContent = card.dataset.name;
                modalAppIcon.src = card.dataset.icon;
                modalAppRating.textContent = card.dataset.rating;
                modalAppDesc.textContent = card.dataset.description;
                modalAppPlatform.textContent = `支持平台: ${card.dataset.platform}`;
                
                modalAppFeatures.innerHTML = '';
                if (card.dataset.features) {
                    card.dataset.features.split('|').forEach(feature => {
                        const featureEl = document.createElement('div');
                        featureEl.className = 'flex items-center gap-3 bg-white/50 dark:bg-gray-700/50 p-3 rounded-lg';
                        const icon = `<svg class="w-5 h-5 text-green-500 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
                        featureEl.innerHTML = `${icon}<span>${feature}</span>`;
                        modalAppFeatures.appendChild(featureEl);
                    });
                }

                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.add('opacity-100');
                    modalContent.classList.remove('scale-95', 'opacity-0');
                }, 10);
            };

            const closeModal = () => {
                modalContent.classList.add('scale-95', 'opacity-0');
                modal.classList.remove('opacity-100');
                setTimeout(() => modal.classList.add('hidden'), 300);
            };

            closeBtn.addEventListener('click', closeModal);
            modalBackdrop.addEventListener('click', closeModal);
            document.addEventListener('keydown', (e) => e.key === 'Escape' && !modal.classList.contains('hidden') && closeModal());

            // --- UI 控制 (无需修改) ---
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            }
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                lightIcon.classList.toggle('hidden');
                darkIcon.classList.toggle('hidden');
            });

            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            menuToggle.addEventListener('click', (e) => { e.stopPropagation(); sidebar.classList.toggle('-translate-x-full'); });
            document.addEventListener('click', (e) => { if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) { sidebar.classList.add('-translate-x-full'); } });
        });
    </script>
</body>
</html>
