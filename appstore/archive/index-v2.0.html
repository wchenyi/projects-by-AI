<!DOCTYPE html>
<html lang="zh-CN" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- PWA and SEO Meta Tags -->
    <title>应用商店</title>
    <meta name="description" content="一个精美的应用商店网页，发现新应用，激发新灵感。">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="./src/img/logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --theme-color-DEFAULT: #868686; /* 默认主题色 */
        }
        body { font-family: 'Inter', sans-serif; }
        .backdrop-blur-lg { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }
        html.dark ::-webkit-scrollbar-thumb { background: #a0aec0; }
        #app-detail-modal.hidden { display: none; }
        
        /* 卡片尺寸和布局 */
        .card-grid-large { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .card-grid-small { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; }
        @media (min-width: 1280px) {
            .card-grid-large { grid-template-columns: repeat(4, 1fr); }
        }

        .app-card-large {
            aspect-ratio: 16 / 10;
            background-image: linear-gradient(to top right, var(--tw-gradient-from, #333), var(--tw-gradient-to, #555));
        }
        .theme-bg-active { background-color: var(--theme-color-DEFAULT); }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="flex h-screen overflow-hidden">
        <!-- 侧边栏 -->
        <aside id="sidebar" class="w-64 bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg p-4 flex-col flex-shrink-0 fixed lg:relative h-full z-30 -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="flex items-center gap-3 mb-8 px-2">
                <img id="site-logo" src="" alt="Site Logo" class="w-8 h-8">
                <h1 id="site-name-sidebar" class="text-xl font-bold"></h1>
            </div>
            <nav id="category-nav" class="flex-1 space-y-2">
                <!-- 分类导航会由JS动态生成 -->
            </nav>
        </aside>

        <!-- 主内容区 -->
        <div id="main-scroll-area" class="flex-1 flex flex-col overflow-auto">
            <!-- 顶部栏 -->
            <header class="sticky top-0 z-20 bg-gray-100/80 dark:bg-gray-900/80 backdrop-blur-lg flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-4">
                    <button id="menu-toggle" class="lg:hidden p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <div class="relative hidden sm:block"><input type="text" id="search-input" placeholder="搜索应用、游戏等" class="w-48 md:w-64 lg:w-96 bg-gray-200 dark:bg-gray-800 border border-transparent focus:ring-2 focus:ring-blue-500 focus:border-transparent rounded-lg py-2 pl-10 pr-4 transition"><svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg id="theme-icon-light" class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2V4M12 20V22M4.92999 4.92999L6.34999 6.34999M17.65 17.65L19.07 19.07M2 12H4M20 12H22M4.92999 19.07L6.34999 17.65M17.65 6.34999L19.07 4.92999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg id="theme-icon-dark" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.75C5.79522 2.75 2.75 5.79522 2.75 12C2.75 18.2048 5.79522 21.25 12 21.25C16.8375 21.25 20.5005 18.2625 21.125 13.5C15.825 14.125 10.125 9.0875 10.5 3.5C11.0875 3.05 11.525 2.75 12 2.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <img src="https://placehold.co/40x40/6366f1/ffffff?text=U" alt="用户头像" class="w-10 h-10 rounded-full">
                </div>
            </header>

            <!-- 滚动内容区 -->
            <main id="main-content" class="p-4 sm:p-6 lg:p-8 space-y-8">
                <!-- 内容由JS动态生成 -->
            </main>
        </div>
    </div>

    <!-- 应用详情 Modal -->
    <div id="app-detail-modal" class="hidden fixed inset-0 z-40 flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="modal-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div id="modal-content" class="relative z-50 w-full max-w-2xl max-h-[90vh] bg-gray-100/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-transform duration-300 scale-95 opacity-0">
            <div class="flex-shrink-0 p-6 flex justify-between items-start border-b border-gray-300 dark:border-gray-700">
                <div class="flex items-start gap-5">
                    <img id="modal-app-icon" src="" alt="App Icon" class="w-20 h-20 object-contain rounded-xl shadow-md flex-shrink-0">
                    <div>
                        <h2 id="modal-app-name" class="text-3xl font-bold"></h2>
                        <div class="flex items-center gap-2 mt-2 text-yellow-400">
                            <span id="modal-app-rating" class="text-lg font-bold text-gray-800 dark:text-gray-200"></span>
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/></svg>
                        </div>
                        <p id="modal-app-platform" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
                    </div>
                </div>
                <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-4">
                <div><h3 class="font-bold text-lg mb-2">简介</h3><p id="modal-app-desc" class="text-gray-600 dark:text-gray-300 text-sm"></p></div>
                <div><h3 class="font-bold text-lg mb-2">特色介绍</h3><div id="modal-app-features" class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm"></div></div>
            </div>
            <div id="modal-download-links" class="flex-shrink-0 p-4 border-t border-gray-300 dark:border-gray-700 bg-white/30 dark:bg-gray-900/30 grid grid-cols-2 lg:grid-cols-4 gap-3"></div>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <button id="back-to-top" class="fixed bottom-6 right-6 z-30 w-12 h-12 rounded-full bg-black/50 dark:bg-white/50 text-white dark:text-black backdrop-blur-sm shadow-lg flex items-center justify-center opacity-0 translate-y-4 transition-all duration-300 hover:scale-110">
        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 19V5m0 0l-4 4m4-4l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>

    <script type="module">
        // ===================================================================================
        // 网站核心配置中心
        // 在这里修改您网站的所有关键信息
        // ===================================================================================
        const CONFIG = {
            // 1. 网站基础信息
            siteName: "应用商店",
            siteLogo: "./src/img/logo.png",
            defaultLogoSVG: `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12L22 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`,

            // 2. 主页免责声明内容 (支持HTML标签)
            disclaimer: `
                <h3 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">必看</h3>
                <ul class="space-y-3 list-disc list-inside text-gray-700 dark:text-gray-300">
                    <li>出于学习与交流目的设立本站，本站所有内容与本人无任何关联 ❗</li>
                    <li>本站不提供任何形式的下载，仅为公开信息的搬运及整理。所有跳转链接均来自互联网，本站无法保证其安全性与可用性。</li>
                    <li><strong>请您自觉遵守我国相关法律规定，利用本站提供的信息进行任何操作，所带来的一切后果由您本人承担。</strong></li>
                    <li>严禁在国内社交平台、公开场合传播本站，请低调使用。</li>
                    <li>所有软件请于下载后的24小时内删除，如果您喜欢，请支持正版。</li>
                </ul>
                <h3 class="text-2xl font-bold mt-10 mb-4 text-gray-800 dark:text-gray-200">相关法律条列</h3>
                <p class="text-sm text-gray-500 dark:text-gray-400">根据《计算机信息网络国际联网安全保护管理办法》规定，任何单位和个人不得利用国际联网制作、复制、查阅和传播煽动抗拒、破坏宪法和法律、行政法规实施的；煽动颠覆国家政权，推翻社会主义制度的；煽动分裂国家、破坏国家统一的等危害国家安全、泄露国家秘密的言论。</p>
            `,

            // 3. 分类信息与主题配置
            categories: [
                { id: 'home', name: '主页', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, themeColor: '#6b7280', gradient: 'from-gray-500 to-gray-700' },
                { id: 'windows', name: 'PC端', file: './apps/windows/data.js', dataKey: 'windowsApps', bannerText: 'Windows 微软', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 5a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V5z" stroke="currentColor" stroke-width="2"/><path d="M8 21h8m-4-4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, themeColor: '#0ea5e9', gradient: 'from-sky-500 to-sky-700' },
                { id: 'apple', name: '苹果端', file: './apps/apple/data.js', dataKey: 'appleApps', bannerText: 'Apple 生态', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.225 3.525c-1.425 0-2.55 1.125-3.225 2.25-.825-1.5-2.325-2.25-3.825-2.25-2.475 0-4.725 2.025-4.725 5.175 0 3.375 2.925 6.375 5.925 8.325 1.2.75 2.55 1.575 2.85 1.575.3 0 1.65-.825 2.85-1.575 3-1.95 5.925-4.95 5.925-8.325 0-3.15-2.25-5.175-4.725-5.175z"/><path d="M15.225 3.525c.9-.075 1.875.3 2.625 1.2.75.9.975 2.1.75 3.15"/></svg>`, themeColor: '#334155', gradient: 'from-slate-600 to-slate-800' },
                { id: 'android', name: '安卓端', file: './apps/android/data.js', dataKey: 'androidApps', bannerText: 'Android 安卓', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 10l.75-2.5M14 4h-4l-1 2M4 10h16v9a2 2 0 01-2 2H6a2 2 0 01-2-2v-9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 7V6l1-2m9 3V6l-1-2m-3 0h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, themeColor: '#22c55e', gradient: 'from-green-500 to-emerald-600' },
                { id: 'linux', name: 'Linux', file: './apps/linux/data.js', dataKey: 'linuxApps', bannerText: 'Linux', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.4 12.76a1 1 0 00-.8 0c-2 1-3.9 2.4-5.2 4.44a1 1 0 00.1 1.4 8.6 8.6 0 0011 0 1 1 0 00.2-1.4c-1.3-2.03-3.2-3.43-5.3-4.44z" stroke="currentColor" stroke-width="2"/><circle cx="15.5" cy="8.5" r="1.5" fill="currentColor"/><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/><path d="M12 2a3.5 3.5 0 00-3.5 3.5V10h7V5.5A3.5 3.5 0 0012 2z" stroke="currentColor" stroke-width="2"/></svg>`, themeColor: '#f97316', gradient: 'from-orange-500 to-amber-600' },
                { id: 'other', name: '其他', file: './apps/other/data.js', dataKey: 'otherApps', bannerText: '其他工具', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a2 2 0 100-4 2 2 0 000 4zM6 12a2 2 0 100-4 2 2 0 000 4zm12 0a2 2 0 100-4 2 2 0 000 4z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, themeColor: '#6366f1', gradient: 'from-indigo-500 to-violet-600' }
            ]
        };

        // ===================================================================================
        // 主应用逻辑
        // ===================================================================================
        const doc = document;
        const mainScrollArea = doc.getElementById('main-scroll-area');
        const mainContent = doc.getElementById('main-content');
        const categoryNav = doc.getElementById('category-nav');
        const searchInput = doc.getElementById('search-input');
        const backToTopBtn = doc.getElementById('back-to-top');

        let allAppsData = {};
        let allAppsList = [];
        let currentCategory = 'home';

        // --- 核心功能函数 ---
        const loadAllData = async () => {
            const dataPromises = CONFIG.categories
                .filter(cat => cat.file)
                .map(cat =>
                    import(cat.file)
                        .then(module => ({ id: cat.id, data: module[cat.dataKey] || [] }))
                        .catch(error => {
                            console.warn(`无法加载分类 "${cat.name}" 的数据文件: ${cat.file}`, error);
                            return { id: cat.id, data: [] };
                        })
                );
            const results = await Promise.all(dataPromises);
            results.forEach(result => {
                allAppsData[result.id] = result.data;
                allAppsList.push(...result.data);
            });
        };

        const renderPage = (categoryId) => {
            mainContent.innerHTML = '';
            const category = CONFIG.categories.find(c => c.id === categoryId);
            if (!category) return;

            // 更新主题色
            doc.documentElement.style.setProperty('--theme-color-DEFAULT', category.themeColor);

            // 渲染Banner
            const banner = createBanner(category);
            mainContent.appendChild(banner);

            if (categoryId === 'home') {
                renderHomePage();
            } else {
                renderAppPage(allAppsData[categoryId]);
            }
            mainScrollArea.scrollTop = 0;
        };
        
        const createBanner = (category) => {
            const banner = doc.createElement('div');
            const text = category.id === 'home' ? CONFIG.siteName : category.bannerText;
            banner.className = `w-full p-8 rounded-2xl flex items-center justify-center text-white bg-gradient-to-br ${category.gradient}`;
            banner.innerHTML = `<h2 class="text-4xl font-black">${text}</h2>`;
            return banner;
        };

        const renderHomePage = () => {
            const homeContainer = doc.createElement('div');
            homeContainer.className = 'bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-md';
            
            // 渲染免责声明
            const disclaimerSection = doc.createElement('div');
            disclaimerSection.innerHTML = CONFIG.disclaimer;
            homeContainer.appendChild(disclaimerSection);

            // 渲染导航卡片
            const navSection = doc.createElement('div');
            navSection.innerHTML = `<h3 class="text-2xl font-bold mt-10 mb-4 text-gray-800 dark:text-gray-200">分类导航</h3>`;
            const navGrid = doc.createElement('div');
            navGrid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4';
            
            CONFIG.categories.filter(c => c.id !== 'home').forEach(cat => {
                const card = doc.createElement('a');
                card.href = '#';
                card.dataset.category = cat.id;
                card.className = `nav-card-home flex items-center gap-4 p-4 rounded-xl shadow transition-all hover:shadow-lg hover:-translate-y-1 bg-gray-100 dark:bg-gray-700`;
                card.innerHTML = `
                    <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center rounded-lg text-white ${cat.gradient.replace('from-', 'bg-').split(' ')[0]}">
                        ${cat.icon}
                    </div>
                    <span class="font-semibold">${cat.name}</span>
                `;
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchCategory(cat.id);
                });
                navGrid.appendChild(card);
            });

            navSection.appendChild(navGrid);
            homeContainer.appendChild(navSection);
            mainContent.appendChild(homeContainer);
        };

        const renderAppPage = (apps) => {
            if (!apps || apps.length === 0) {
                mainContent.insertAdjacentHTML('beforeend', `<div class="text-center py-16"><p class="text-gray-500">这个分类下还没有应用，请检查对应的 data.js 文件。</p></div>`);
                return;
            }

            const largeApps = apps.filter(app => app.size === 'large');
            const otherApps = apps.filter(app => app.size !== 'large');

            if (largeApps.length > 0) {
                mainContent.appendChild(createSectionTitle('推荐应用'));
                const grid = doc.createElement('div');
                grid.className = 'card-grid-large';
                largeApps.forEach(app => grid.appendChild(createAppCard(app)));
                mainContent.appendChild(grid);
            }

            if (otherApps.length > 0) {
                mainContent.appendChild(createSectionTitle('其他软件'));
                const grid = doc.createElement('div');
                grid.className = 'card-grid-small';
                otherApps.forEach(app => grid.appendChild(createAppCard(app)));
                mainContent.appendChild(grid);
            }
        };

        const createSectionTitle = (title) => {
            const titleEl = doc.createElement('h3');
            titleEl.className = 'text-2xl font-bold border-b-2 border-gray-200 dark:border-gray-700 pb-2 mb-4';
            titleEl.textContent = title;
            return titleEl;
        };

        const createAppCard = (app) => {
            const card = doc.createElement('div');
            card.className = 'app-card group cursor-pointer transition-all duration-300 rounded-2xl overflow-hidden shadow-lg relative';
            
            let typeBadge = '';
            if (app.type) {
                const isDesktop = app.type.toLowerCase() === 'desktop';
                const badgeColor = isDesktop ? 'bg-sky-500' : 'bg-green-500';
                const badgeText = isDesktop ? '桌面' : '移动';
                typeBadge = `<span class="absolute top-3 right-3 text-xs font-semibold text-white ${badgeColor} px-2 py-0.5 rounded-full z-10">${badgeText}</span>`;
            }

            if (app.size === 'large') {
                const category = CONFIG.categories.find(c => c.id === currentCategory) || {};
                card.className += ` app-card-large flex flex-col justify-between p-4 text-white ${category.gradient}`;
                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <img src="${app.icon}" alt="${app.name} icon" class="w-14 h-14 object-contain rounded-lg bg-white/20 p-1 shadow-md">
                        ${typeBadge}
                    </div>
                    <div>
                        <h4 class="font-bold text-xl">${app.name}</h4>
                        <p class="text-sm text-white/80">${app.category}</p>
                    </div>
                `;
            } else { // medium & small
                card.className += ' bg-white dark:bg-gray-800 p-4 flex flex-col items-center justify-center text-center hover:-translate-y-1';
                card.innerHTML = `
                    ${typeBadge}
                    <img src="${app.icon}" alt="${app.name} icon" class="w-16 h-16 object-contain mb-3">
                    <h4 class="font-semibold w-full truncate">${app.name}</h4>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${app.category}</p>
                `;
            }

            Object.entries(app).forEach(([key, value]) => {
                card.dataset[key] = typeof value === 'object' ? JSON.stringify(value) : value;
            });
            card.addEventListener('click', () => openModal(card));
            return card;
        };

        const renderNav = () => {
            CONFIG.categories.forEach(cat => {
                const link = doc.createElement('a');
                link.href = '#';
                link.dataset.category = cat.id;
                link.className = 'nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors';
                link.innerHTML = `${cat.icon}<span>${cat.name}</span>`;
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    switchCategory(cat.id);
                });
                categoryNav.appendChild(link);
            });
        };

        const switchCategory = (categoryId) => {
            currentCategory = categoryId;
            searchInput.value = '';
            renderPage(categoryId);
            updateNavActiveState();
            // Close sidebar on mobile after navigation
            if (window.innerWidth < 1024) {
                 doc.getElementById('sidebar').classList.add('-translate-x-full');
            }
        };

        const updateNavActiveState = () => {
            doc.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('text-white', 'font-semibold', 'shadow', 'theme-bg-active');
                link.classList.add('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                if (link.dataset.category === currentCategory) {
                    link.classList.add('text-white', 'font-semibold', 'shadow', 'theme-bg-active');
                    link.classList.remove('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                }
            });
        };
        
        // --- 初始化函数 ---
        const init = async () => {
            // Site Identity
            doc.title = CONFIG.siteName;
            doc.getElementById('site-name-sidebar').textContent = CONFIG.siteName;
            const logoImg = doc.getElementById('site-logo');
            logoImg.onerror = () => { logoImg.outerHTML = `<div class="w-8 h-8 text-blue-500">${CONFIG.defaultLogoSVG}</div>`; };
            logoImg.src = CONFIG.siteLogo;

            // PWA Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').catch(err => console.error('Service worker registration failed:', err));
            }

            renderNav();
            await loadAllData();
            switchCategory('home');
        };

        // --- 事件监听 ---
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm) {
                const filteredApps = allAppsList.filter(app => app.name.toLowerCase().includes(searchTerm) || app.category.toLowerCase().includes(searchTerm));
                mainContent.innerHTML = '';
                mainContent.appendChild(createBanner({id: 'search', bannerText: `搜索: ${searchTerm}`, gradient: 'from-gray-500 to-gray-700'}));
                renderAppPage(filteredApps);
            } else {
                renderPage(currentCategory);
            }
        });

        mainScrollArea.addEventListener('scroll', () => {
            if (mainScrollArea.scrollTop > 200) {
                backToTopBtn.classList.remove('opacity-0', 'translate-y-4');
            } else {
                backToTopBtn.classList.add('opacity-0', 'translate-y-4');
            }
        });
        backToTopBtn.addEventListener('click', () => mainScrollArea.scrollTo({ top: 0, behavior: 'smooth' }));

        // --- Modal 逻辑 ---
        const modal = doc.getElementById('app-detail-modal'), modalContent = doc.getElementById('modal-content'), modalBackdrop = doc.getElementById('modal-backdrop'), closeBtn = doc.getElementById('modal-close-btn'), modalAppName = doc.getElementById('modal-app-name'), modalAppIcon = doc.getElementById('modal-app-icon'), modalAppRating = doc.getElementById('modal-app-rating'), modalAppDesc = doc.getElementById('modal-app-desc'), modalAppFeatures = doc.getElementById('modal-app-features'), modalAppPlatform = doc.getElementById('modal-app-platform'), modalDownloadLinks = doc.getElementById('modal-download-links');
        const openModal = (card) => {
            const appData = card.dataset;
            modalAppName.textContent = appData.name;
            modalAppIcon.src = appData.icon;
            modalAppRating.textContent = appData.rating;
            modalAppDesc.textContent = appData.description;
            modalAppPlatform.textContent = `支持平台: ${appData.platform}`;
            
            modalAppFeatures.innerHTML = '';
            const features = JSON.parse(appData.features || '[]');
            features.forEach(feature => {
                const featureEl = doc.createElement('div');
                featureEl.className = 'flex items-center gap-2 bg-white/50 dark:bg-gray-700/50 p-2 rounded-lg';
                featureEl.innerHTML = `<svg class="w-4 h-4 text-green-500 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>${feature}</span>`;
                modalAppFeatures.appendChild(featureEl);
            });

            modalDownloadLinks.innerHTML = '';
            const downloads = JSON.parse(appData.downloads || '{}');
            const downloadTypes = [
                { key: 'appStore', text: '应用商店', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v9m0 0l-3-3m3 3l3-3m-3 12a9 9 0 110-18 9 9 0 010 18z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-blue-600 hover:bg-blue-700' },
                { key: 'github', text: 'Github', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>`, color: 'bg-gray-800 hover:bg-gray-900 dark:bg-gray-600 dark:hover:bg-gray-700' },
                { key: 'official', text: '官网下载', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.72M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.72-1.72" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-green-600 hover:bg-green-700' },
                { key: 'alternative', text: '备用下载', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-gray-500 hover:bg-gray-600' },
            ];
            downloadTypes.forEach(type => {
                if (downloads[type.key]) {
                    const link = doc.createElement('a');
                    link.href = downloads[type.key];
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.className = `flex items-center justify-center gap-2 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 shadow-lg transform hover:-translate-y-0.5 ${type.color}`;
                    link.innerHTML = `${type.icon}<span>${type.text}</span>`;
                    modalDownloadLinks.appendChild(link);
                }
            });
            if(modalDownloadLinks.innerHTML === '') modalDownloadLinks.innerHTML = `<p class="text-center text-gray-500 col-span-full">暂无可用下载链接</p>`;

            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.add('opacity-100'); modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
        };
        const closeModal = () => {
            modalContent.classList.add('scale-95', 'opacity-0');
            modal.classList.remove('opacity-100');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };
        closeBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);
        doc.addEventListener('keydown', (e) => e.key === 'Escape' && !modal.classList.contains('hidden') && closeModal());

        // --- UI 控制 ---
        const themeToggle = doc.getElementById('theme-toggle'), lightIcon = doc.getElementById('theme-icon-light'), darkIcon = doc.getElementById('theme-icon-dark');
        if (localStorage.getItem('theme') === 'dark') {
            doc.documentElement.classList.add('dark');
            lightIcon.classList.add('hidden');
            darkIcon.classList.remove('hidden');
        }
        themeToggle.addEventListener('click', () => {
            const isDark = doc.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            lightIcon.classList.toggle('hidden');
            darkIcon.classList.toggle('hidden');
        });

        const menuToggle = doc.getElementById('menu-toggle'), sidebar = doc.getElementById('sidebar');
        menuToggle.addEventListener('click', (e) => { e.stopPropagation(); sidebar.classList.toggle('-translate-x-full'); });
        doc.addEventListener('click', (e) => { if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) { sidebar.classList.add('-translate-x-full'); } });

        // --- 启动应用 ---
        init();
    </script>
</body>
</html>
