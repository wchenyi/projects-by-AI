<!DOCTYPE html>
<html lang="zh-CN" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用商店</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .backdrop-blur-lg { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }
        html.dark ::-webkit-scrollbar-thumb { background: #a0aec0; }
        #app-detail-modal.hidden { display: none; }
        .grid-auto-fit { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        
        /* 图标大小控制 */
        .app-icon-large { width: 4.5rem; height: 4.5rem; object-fit: contain; }
        .app-icon-medium { width: 4rem; height: 4rem; object-fit: contain; }
        .app-icon-small { width: 3rem; height: 3rem; object-fit: contain; }
        .modal-app-icon { width: 5rem; height: 5rem; object-fit: contain; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div class="flex h-screen overflow-hidden">
        <!-- 侧边栏 -->
        <aside id="sidebar" class="w-64 bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg p-4 flex-col flex-shrink-0 fixed lg:relative h-full z-20 -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
            <div class="flex items-center gap-3 mb-8">
                <svg class="w-8 h-8 text-blue-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 7L12 12L22 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <h1 class="text-xl font-bold">应用商店</h1>
            </div>
            <nav id="category-nav" class="flex-1 space-y-2">
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase">分类</p>
                <!-- 分类导航会由JS动态生成 -->
            </nav>
        </aside>

        <!-- 主内容区 -->
        <div class="flex-1 flex flex-col overflow-auto">
            <!-- 顶部栏 -->
            <header class="sticky top-0 z-10 bg-gray-100/80 dark:bg-gray-900/80 backdrop-blur-lg flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center gap-4">
                    <button id="menu-toggle" class="lg:hidden p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <div class="relative hidden sm:block"><input type="text" id="search-input" placeholder="搜索应用、游戏等" class="w-48 md:w-64 lg:w-96 bg-gray-200 dark:bg-gray-800 border border-transparent focus:ring-2 focus:ring-blue-500 focus:border-transparent rounded-lg py-2 pl-10 pr-4 transition"><svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                </div>
                <div class="flex items-center gap-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg id="theme-icon-light" class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 2V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 20V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.92999 4.92999L6.34999 6.34999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.65 17.65L19.07 19.07" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 12H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4.92999 19.07L6.34999 17.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.65 6.34999L19.07 4.92999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><svg id="theme-icon-dark" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.75C5.79522 2.75 2.75 5.79522 2.75 12C2.75 18.2048 5.79522 21.25 12 21.25C16.8375 21.25 20.5005 18.2625 21.125 13.5C15.825 14.125 10.125 9.0875 10.5 3.5C11.0875 3.05 11.525 2.75 12 2.75Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <img src="https://placehold.co/40x40/6366f1/ffffff?text=U" alt="用户头像" class="w-10 h-10 rounded-full">
                </div>
            </header>

            <!-- 滚动内容区 -->
            <main id="main-content" class="p-4 sm:p-6 lg:p-8 space-y-8">
                <div class="text-center py-16"><p class="text-gray-500">正在加载应用...</p></div>
            </main>
        </div>
    </div>

    <!-- 应用详情 Modal -->
    <div id="app-detail-modal" class="hidden fixed inset-0 z-30 flex items-center justify-center p-4 transition-opacity duration-300">
        <div id="modal-backdrop" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div id="modal-content" class="relative z-40 w-full max-w-4xl max-h-[90vh] bg-gray-100/80 dark:bg-gray-800/80 backdrop-blur-lg rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-transform duration-300 scale-95 opacity-0">
            <div class="flex-shrink-0 p-6 flex justify-between items-start border-b border-gray-300 dark:border-gray-700">
                <div class="flex items-start gap-5">
                    <img id="modal-app-icon" src="" alt="App Icon" class="modal-app-icon rounded-xl shadow-md flex-shrink-0">
                    <div>
                        <h2 id="modal-app-name" class="text-3xl font-bold"></h2>
                        <div class="flex items-center gap-2 mt-2 text-yellow-400">
                            <span id="modal-app-rating" class="text-lg font-bold text-gray-800 dark:text-gray-200"></span>
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21L16.54 13.97L22 9.24L14.81 8.63L12 2L9.19 8.63L2 9.24L7.46 13.97L5.82 21L12 17.27Z"/></svg>
                        </div>
                        <p id="modal-app-platform" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
                    </div>
                </div>
                <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600"><svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <div><h3 class="font-bold text-lg mb-2">简介</h3><p id="modal-app-desc" class="text-gray-600 dark:text-gray-300"></p></div>
                <div><h3 class="font-bold text-lg mb-3">特色介绍</h3><div id="modal-app-features" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div></div>
            </div>
            <!-- 下载按钮容器 -->
            <div id="modal-download-links" class="flex-shrink-0 p-6 border-t border-gray-300 dark:border-gray-700 bg-white/30 dark:bg-gray-900/30 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- 下载按钮将由JS动态生成 -->
            </div>
        </div>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', async () => {
            const mainContent = document.getElementById('main-content');
            const categoryNav = document.getElementById('category-nav');
            const searchInput = document.getElementById('search-input');
            
            let allAppsData = {};
            let allAppsList = [];
            let currentCategory = 'windows';

            const categories = [
                { id: 'windows', name: 'PC端', file: './apps/windows/data.js', dataKey: 'windowsApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 6a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2H7a2 2 0 01-2-2V6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 16h18m-12 4h6m-3-4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'apple', name: '苹果端', file: './apps/apple/data.js', dataKey: 'appleApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.28.96a.83.83 0 00-.85.25C12.5 2.37 11.1 4.33 11.1 6.5c0 2.3 1.59 4.29 3.32 5.16a.4.4 0 01.18.37c0 .18-.1.34-.26.43-1.83 1-3.23 2.78-3.23 4.93 0 3.1 2.3 5.61 5.3 5.61a.48.48 0 00.34-.15c2.9-2.91 4.42-6.3 4.42-9.64 0-3.41-1.7-6.2-4.17-7.25z" fill="currentColor"/><path d="M13.15 2.11a4.33 4.33 0 00-2.88 1.88A10.5 10.5 0 008.2 7.15c-2.22 0-4.2-1.2-5.3-3.11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'android', name: '安卓端', file: './apps/android/data.js', dataKey: 'androidApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="7" y="2" width="10" height="20" rx="2" stroke="currentColor" stroke-width="2"/><path d="M10 18h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>` },
                { id: 'linux', name: 'Linux', file: './apps/linux/data.js', dataKey: 'linuxApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21C12 21 15 18.5 15 15C15 11.6863 12 11 12 6C12 11 9 11.6863 9 15C9 18.5 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 6C12 3.79086 10.2091 2 8 2C5.79086 2 4 3.79086 4 6m11 9c0 0 1.5 1 2 2 1.5 2.5-2 5-5 4M9 15c0 0-1.5 1-2 2-1.5 2.5 2 5 5 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
                { id: 'other', name: '其他', file: './apps/other/data.js', dataKey: 'otherApps', icon: `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a2 2 0 100-4 2 2 0 000 4zM6 12a2 2 0 100-4 2 2 0 000 4zm12 0a2 2 0 100-4 2 2 0 000 4z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>` },
            ];

            const loadAllData = async () => {
                const dataPromises = categories.map(cat => 
                    import(cat.file)
                        .then(module => ({ id: cat.id, data: module[cat.dataKey] || [] }))
                        .catch(error => {
                            console.warn(`无法加载分类 "${cat.name}" 的数据文件: ${cat.file}`, error);
                            return { id: cat.id, data: [] };
                        })
                );
                const results = await Promise.all(dataPromises);
                results.forEach(result => {
                    allAppsData[result.id] = result.data;
                    allAppsList.push(...result.data);
                });
            };

            const renderApps = (apps) => {
                mainContent.innerHTML = '';
                if (!apps || apps.length === 0) {
                    mainContent.innerHTML = `<div class="text-center py-16"><p class="text-gray-500">这个分类下还没有应用，请检查对应的 data.js 文件。</p></div>`;
                    return;
                }
                apps.sort((a, b) => {
                    const sizes = { 'large': 3, 'medium': 2, 'small': 1 };
                    return (sizes[b.size] || 1) - (sizes[a.size] || 1);
                });
                const appGrid = document.createElement('div');
                appGrid.className = 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4';
                apps.forEach(app => appGrid.appendChild(createAppCard(app)));
                mainContent.appendChild(appGrid);
            };

            const createAppCard = (app) => {
                const card = document.createElement('div');
                card.className = 'app-card group cursor-pointer transition-all duration-300';
                let typeBadge = '';
                if (app.type) {
                    const isDesktop = app.type.toLowerCase() === 'desktop';
                    const badgeColor = isDesktop ? 'bg-sky-500' : 'bg-green-500';
                    const badgeText = isDesktop ? '桌面' : '移动';
                    typeBadge = `<span class="absolute top-2 right-2 text-xs font-semibold text-white ${badgeColor} px-2 py-0.5 rounded-full z-10">${badgeText}</span>`;
                }
                const size = app.size || 'small';
                if (size === 'large') {
                    card.classList.add('col-span-2', 'row-span-2', 'rounded-2xl', 'overflow-hidden', 'relative', 'shadow-lg', 'hover:shadow-2xl');
                    card.innerHTML = `<img src="https://images.unsplash.com/photo-1557682250-33bd709cbe85?q=80&w=2670&auto=format&fit=crop" alt="${app.name} 背景" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"><div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div><div class="absolute bottom-0 left-0 p-4 text-white"><img src="${app.icon}" alt="${app.name} 图标" class="w-12 h-12 mb-2 rounded-lg bg-white p-1 object-contain"><h4 class="font-bold text-lg">${app.name}</h4><p class="text-sm text-gray-300">${app.category}</p></div>${typeBadge}`;
                } else if (size === 'medium') {
                    card.classList.add('col-span-2', 'rounded-2xl', 'bg-white', 'dark:bg-gray-800', 'p-4', 'flex', 'items-center', 'gap-4', 'shadow-md', 'hover:shadow-xl', 'hover:-translate-y-1', 'relative');
                    card.innerHTML = `<img src="${app.icon}" alt="${app.name} 图标" class="app-icon-medium rounded-lg flex-shrink-0"><div class="overflow-hidden"><h4 class="font-semibold truncate">${app.name}</h4><p class="text-xs text-gray-500 dark:text-gray-400">${app.category}</p></div>${typeBadge}`;
                } else {
                    card.classList.add('rounded-2xl', 'bg-white', 'dark:bg-gray-800', 'p-4', 'flex', 'flex-col', 'items-center', 'justify-center', 'text-center', 'shadow-md', 'hover:shadow-xl', 'hover:-translate-y-1', 'relative');
                    card.innerHTML = `<img src="${app.icon}" alt="${app.name} 图标" class="app-icon-small mb-3"><h4 class="font-semibold w-full truncate">${app.name}</h4><p class="text-xs text-gray-500 dark:text-gray-400">${app.category}</p>${typeBadge}`;
                }
                
                // 将数据绑定到卡片上
                Object.entries(app).forEach(([key, value]) => {
                    if (typeof value === 'object' && value !== null) {
                        card.dataset[key] = JSON.stringify(value);
                    } else {
                        card.dataset[key] = value;
                    }
                });
                
                card.addEventListener('click', () => openModal(card));
                return card;
            };
            
            const renderNav = () => {
                categories.forEach(cat => {
                    const link = document.createElement('a');
                    link.href = '#';
                    link.dataset.category = cat.id;
                    link.className = 'nav-link flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors';
                    link.innerHTML = `${cat.icon}<span>${cat.name}</span>`;
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentCategory = cat.id;
                        searchInput.value = '';
                        renderApps(allAppsData[currentCategory]);
                        updateNavActiveState();
                    });
                    categoryNav.appendChild(link);
                });
            };

            const updateNavActiveState = () => {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('text-white', 'bg-blue-500', 'font-semibold', 'shadow');
                    link.classList.add('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    if (link.dataset.category === currentCategory) {
                        link.classList.add('text-white', 'bg-blue-500', 'font-semibold', 'shadow');
                        link.classList.remove('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    }
                });
            };

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm) {
                    const filteredApps = allAppsList.filter(app => app.name.toLowerCase().includes(searchTerm) || app.category.toLowerCase().includes(searchTerm));
                    renderApps(filteredApps);
                } else {
                    renderApps(allAppsData[currentCategory]);
                }
            });

            // --- Modal 逻辑 ---
            const modal = document.getElementById('app-detail-modal'), modalContent = document.getElementById('modal-content'), modalBackdrop = document.getElementById('modal-backdrop'), closeBtn = document.getElementById('modal-close-btn'), modalAppName = document.getElementById('modal-app-name'), modalAppIcon = document.getElementById('modal-app-icon'), modalAppRating = document.getElementById('modal-app-rating'), modalAppDesc = document.getElementById('modal-app-desc'), modalAppFeatures = document.getElementById('modal-app-features'), modalAppPlatform = document.getElementById('modal-app-platform'), modalDownloadLinks = document.getElementById('modal-download-links');
            
            const openModal = (card) => {
                const appData = card.dataset;
                modalAppName.textContent = appData.name;
                modalAppIcon.src = appData.icon;
                modalAppRating.textContent = appData.rating;
                modalAppDesc.textContent = appData.description;
                modalAppPlatform.textContent = `支持平台: ${appData.platform}`;
                
                modalAppFeatures.innerHTML = '';
                const features = JSON.parse(appData.features || '[]');
                features.forEach(feature => {
                    const featureEl = document.createElement('div');
                    featureEl.className = 'flex items-center gap-3 bg-white/50 dark:bg-gray-700/50 p-3 rounded-lg';
                    featureEl.innerHTML = `<svg class="w-5 h-5 text-green-500 flex-shrink-0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>${feature}</span>`;
                    modalAppFeatures.appendChild(featureEl);
                });

                // --- 渲染下载按钮 ---
                modalDownloadLinks.innerHTML = '';
                const downloads = JSON.parse(appData.downloads || '{}');
                const downloadTypes = [
                    { key: 'appStore', text: '应用商店', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v9m0 0l-3-3m3 3l3-3m-3 12a9 9 0 110-18 9 9 0 010 18z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-blue-600 hover:bg-blue-700' },
                    { key: 'github', text: 'Github', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>`, color: 'bg-gray-800 hover:bg-gray-900 dark:bg-gray-600 dark:hover:bg-gray-700' },
                    { key: 'official', text: '官网下载', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.72" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.72-1.72" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-green-600 hover:bg-green-700' },
                    { key: 'alternative', text: '备用下载', icon: `<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4m14-7l-5-5-5 5m5-5v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, color: 'bg-gray-500 hover:bg-gray-600' },
                ];

                downloadTypes.forEach(type => {
                    if (downloads[type.key]) {
                        const link = document.createElement('a');
                        link.href = downloads[type.key];
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                        link.className = `flex items-center justify-center gap-2 text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 shadow-lg transform hover:-translate-y-0.5 ${type.color}`;
                        link.innerHTML = `${type.icon}<span>${type.text}</span>`;
                        modalDownloadLinks.appendChild(link);
                    }
                });
                if(modalDownloadLinks.innerHTML === '') {
                    modalDownloadLinks.innerHTML = `<p class="text-center text-gray-500 col-span-full">暂无可用下载链接</p>`;
                }

                modal.classList.remove('hidden');
                setTimeout(() => { modal.classList.add('opacity-100'); modalContent.classList.remove('scale-95', 'opacity-0'); }, 10);
            };
            const closeModal = () => {
                modalContent.classList.add('scale-95', 'opacity-0');
                modal.classList.remove('opacity-100');
                setTimeout(() => modal.classList.add('hidden'), 300);
            };
            closeBtn.addEventListener('click', closeModal);
            modalBackdrop.addEventListener('click', closeModal);
            document.addEventListener('keydown', (e) => e.key === 'Escape' && !modal.classList.contains('hidden') && closeModal());

            // --- UI 控制 ---
            const themeToggle = document.getElementById('theme-toggle'), lightIcon = document.getElementById('theme-icon-light'), darkIcon = document.getElementById('theme-icon-dark');
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            }
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                lightIcon.classList.toggle('hidden');
                darkIcon.classList.toggle('hidden');
            });

            const menuToggle = document.getElementById('menu-toggle'), sidebar = document.getElementById('sidebar');
            menuToggle.addEventListener('click', (e) => { e.stopPropagation(); sidebar.classList.toggle('-translate-x-full'); });
            document.addEventListener('click', (e) => { if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) { sidebar.classList.add('-translate-x-full'); } });
            
            // --- 初始化流程 ---
            renderNav();
            await loadAllData();
            renderApps(allAppsData[currentCategory]);
            updateNavActiveState();
        });
    </script>
</body>
</html>
