<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…«å¦ç´ æç”Ÿæˆå™¨ - I Ching Hexagram Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --md-sys-color-primary: #6750A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #EADDFF;
            --md-sys-color-on-primary-container: #21005D;
            --md-sys-color-secondary: #625B71;
            --md-sys-color-secondary-container: #E8DEF8;
            --md-sys-color-on-secondary-container: #1D192B;
            --md-sys-color-tertiary: #7D5260;
            --md-sys-color-tertiary-container: #FFD8E4;
            --md-sys-color-on-tertiary-container: #31111D;
            --md-sys-color-error-container: #F9DEDC;
            --md-sys-color-on-error-container: #410E0B;
            --md-sys-color-background: #FFFBFE;
            --md-sys-color-on-background: #1C1B1F;
            --md-sys-color-surface: #FFFBFE;
            --md-sys-color-on-surface: #1C1B1F;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-outline-variant: #CAC4D0;
            --text-color: #1C1B1F;
            --card-bg: #FFFFFF;
            --elevation-1: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 1px 3px 1px rgba(0, 0, 0, 0.15);
            --elevation-2: 0 1px 2px 0 rgba(0, 0, 0, 0.3), 0 2px 6px 2px rgba(0, 0, 0, 0.15);
            --elevation-3: 0 4px 8px 3px rgba(0, 0, 0, 0.15), 0 1px 3px 0 rgba(0, 0, 0, 0.3);
            
            --wuxing-jin: #FFB74D;
            --wuxing-mu: #66BB6A;
            --wuxing-shui: #42A5F5;
            --wuxing-huo: #EF5350;
            --wuxing-tu: #8D6E63;
        }

        [data-theme="dark"] {
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-primary-container: #4F378B;
            --md-sys-color-on-primary-container: #EADDFF;
            --md-sys-color-secondary-container: #4A4458;
            --md-sys-color-on-secondary-container: #E8DEF8;
            --md-sys-color-tertiary: #EFB8C8;
            --md-sys-color-tertiary-container: #633B48;
            --md-sys-color-on-tertiary-container: #FFD8E4;
            --md-sys-color-error-container: #8C1D18;
            --md-sys-color-on-error-container: #F9DEDC;
            --md-sys-color-background: #1C1B1F;
            --md-sys-color-on-background: #E6E1E5;
            --md-sys-color-surface: #1C1B1F;
            --md-sys-color-on-surface: #E6E1E5;
            --md-sys-color-surface-variant: #49454F;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline-variant: #49454F;
            --text-color: #E6E1E5;
            --card-bg: #2B2930;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans SC', -apple-system, sans-serif;
            background: var(--md-sys-color-background);
            color: var(--md-sys-color-on-background);
            line-height: 1.6;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }

        header {
            background: var(--md-sys-color-surface);
            box-shadow: var(--elevation-1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 600;
            color: var(--md-sys-color-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle {
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border: none;
            padding: 12px 20px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--elevation-1);
        }

        .theme-toggle:hover {
            box-shadow: var(--elevation-2);
            transform: translateY(-2px);
        }

        .instructions {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            padding: 24px;
            border-radius: 24px;
            margin-bottom: 32px;
            box-shadow: var(--elevation-1);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .instructions h2 {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .instructions ul { list-style: none; }

        .instructions li {
            padding: 8px 0 8px 24px;
            position: relative;
        }

        .instructions li::before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--md-sys-color-primary);
            font-weight: bold;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        @media (min-width: 1024px) {
            .main-grid { grid-template-columns: 1fr 1fr; }
        }

        .card {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 24px;
            box-shadow: var(--elevation-2);
            transition: all 0.3s ease;
        }

        .card:hover { box-shadow: var(--elevation-3); }

        .card-title {
            font-family: 'Noto Serif SC', serif;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--md-sys-color-on-surface);
            border-bottom: 2px solid var(--md-sys-color-outline-variant);
            padding-bottom: 12px;
        }

        .canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: clamp(16px, 4vw, 32px);
            background: var(--md-sys-color-surface-variant);
            border-radius: 16px;
            min-height: 400px;
            overflow-x: auto;
        }

        #hexagramCanvas {
            background: transparent;
            cursor: pointer;
            max-width: 100%;
            height: auto;
        }

        .controls-grid { 
            display: grid; 
            gap: 12px;
            font-size: 0.95rem;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group label {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;

        }

        input[type="color"] {
            width: 50px;
            height: 35px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        input[type="color"]:hover { transform: scale(1.1); }

        .color-value {
            font-family: 'Consolas', monospace;
            padding: 6px 10px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px;
        }

        .toggle-switch input { opacity: 0; width: 0; height: 0; }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--md-sys-color-surface-variant);
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: var(--md-sys-color-on-surface-variant);
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: var(--md-sys-color-primary); }
        input:checked + .slider:before {
            transform: translateX(20px);
            background-color: var(--md-sys-color-on-primary);
        }

        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Noto Sans SC', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }

        .btn-primary {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: var(--elevation-2);
        }

        .btn-primary:hover {
            box-shadow: var(--elevation-3);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: var(--elevation-1);
        }

        .btn-secondary:hover {
            box-shadow: var(--elevation-2);
            transform: translateY(-2px);
        }

        .line-customization { margin-top: 20px; }
        .line-controls { display: grid; gap: 10px; margin-top: 12px; }

        .line-control {
            display: grid;
            grid-template-columns: 70px 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 10px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 12px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .line-control:hover { background: var(--md-sys-color-primary-container); }

        .line-label {
            font-weight: 500;
            font-family: 'Noto Serif SC', serif;
        }

        .special-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .tag {
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 0.85rem;
            font-weight: 500;
            font-family: 'Noto Serif SC', serif;
        }

        .tag-youhun {
            background: var(--md-sys-color-tertiary-container);
            color: var(--md-sys-color-on-tertiary-container);
        }

        .tag-guihun {
            background: var(--md-sys-color-error-container);
            color: var(--md-sys-color-on-error-container);
        }

        .tag-biyue {
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
        }

        .tag-liuhe { background: #E8F5E9; color: #1B5E20; }
        .tag-liuchong { background: #FFF3E0; color: #E65100; }
        .tag-bengong { background: #E3F2FD; color: #0D47A1; }

        [data-theme="dark"] .tag-liuhe { background: #1B5E20; color: #C8E6C9; }
        [data-theme="dark"] .tag-liuchong { background: #E65100; color: #FFE0B2; }
        [data-theme="dark"] .tag-bengong { background: #0D47A1; color: #BBDEFB; }

        footer {
            text-align: center;
            padding: 32px;
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.9rem;
            margin-top: 48px;
        }

        @keyframes lineToggle {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .line-toggling { animation: lineToggle 0.3s ease; }

        .info-display {
            margin-top: 16px;
            padding: 16px;
            background: var(--md-sys-color-surface-variant);
            border-radius: 12px;
            font-family: 'Noto Serif SC', serif;
        }

        .info-row {
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .info-label {
            font-weight: 600;
            color: var(--md-sys-color-primary);
        }

        .info-value { font-weight: 500; }

        .symbol-display {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .symbol-text {
            font-size: 2rem;
            font-family: serif;
        }

        .copy-btn {
            padding: 8px 16px;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--elevation-1);
        }

        .copy-btn.copied {
            background: #4CAF50;
            color: white;
        }

        @media (max-width: 768px) {
            .container { padding: 12px; }
            .card { padding: 16px; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; min-width: auto; }
            .line-control {
                grid-template-columns: 60px 1fr auto;
                gap: 8px;
                padding: 8px;
                font-size: 0.85rem;
            }
            .canvas-container { 
                padding: 12px;
                min-height: 300px;
            }
            #hexagramCanvas {
                transform-origin: center;
            }
            .info-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            .symbol-display {
                width: 100%;
                justify-content: space-between;
            }
        }

        .section-compact {
            margin-top: 16px;
        }

        .section-compact .card-title {
            font-size: 1.1rem;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1><span style="font-size: 2em;">â˜°</span>å…«å¦ç´ æç”Ÿæˆå™¨</h1>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="themeIcon">ğŸŒ™</span> <span id="themeText">æ·±è‰²æ¨¡å¼</span>
            </button>
        </div>
    </header>

    <div class="container">
        <div class="instructions">
            <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
            <ul>
                <li><strong>åˆ‡æ¢çˆ»ï¼š</strong>ç‚¹å‡»ç”»å¸ƒä¸­çš„ä»»æ„çˆ»ï¼Œé˜´çˆ»ä¼šå˜é˜³çˆ»ï¼Œé˜³çˆ»ä¼šå˜é˜´çˆ»</li>
                <li><strong>åŠ¨æ€æ›´æ–°ï¼š</strong>åˆ‡æ¢çˆ»åï¼Œå¦åã€åœ°æ”¯ã€ä¸–åº”ã€å…­äº²ä¼šè‡ªåŠ¨æ›´æ–°</li>
                <li><strong>è‡ªå®šä¹‰é¢œè‰²ï¼š</strong>å¯ä»¥ä¸ºæ¯ä¸€çˆ»è®¾ç½®ç‹¬ç‰¹çš„é¢œè‰²</li>
                <li><strong>äº”è¡Œé¢œè‰²ï¼š</strong>å¯ç”¨åï¼Œåœ°æ”¯å’Œå¦å®«ä¼šæŒ‰äº”è¡Œæ˜¾ç¤ºé¢œè‰²</li>
                <li><strong>å¤åˆ¶ç¬¦å·ï¼š</strong>ç‚¹å‡»å³ä¸Šæ–¹å¤åˆ¶æŒ‰é’®å¤åˆ¶å¦è±¡ç¬¦å·</li>
            </ul>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2 class="card-title">å¦è±¡é¢„è§ˆ</h2>
                <div class="canvas-container">
                    <canvas id="hexagramCanvas"></canvas>
                </div>
                <div id="hexagramInfo" class="info-display"></div>
            </div>

            <div class="card">
                <h2 class="card-title">æ˜¾ç¤ºè®¾ç½®</h2>
                <div class="controls-grid">
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showName" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºå¦å
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showEarthlyBranches" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºåœ°æ”¯
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showShiYing" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºä¸–åº”
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showPalace" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºå¦å®«
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showWuxing" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºäº”è¡Œ
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showLiuqin" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºå…­äº²
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="useWuxingColors" onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            ä½¿ç”¨äº”è¡Œé¢œè‰²
                        </label>
                    </div>
                    <div class="control-group">
                        <label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="showSpecialTags" checked onchange="updateCanvas()">
                                <span class="slider"></span>
                            </label>
                            æ˜¾ç¤ºç‰¹æ®Šå¦æ ‡ç­¾
                        </label>
                    </div>
                </div>

                <div class="line-customization section-compact">
                    <h3 class="card-title">çˆ»çš„é¢œè‰²è®¾ç½®</h3>
                    <div class="line-controls" id="lineColors"></div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="copySymbol()">ğŸ“‹ å¤åˆ¶ç¬¦å·</button>
                    <button class="btn btn-primary" onclick="downloadPNG()">ğŸ“¥ ä¸‹è½½PNG</button>
                    <button class="btn btn-secondary" onclick="resetColors()">ğŸ”„ é‡ç½®é¢œè‰²</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>å…«å¦ç´ æç”Ÿæˆå™¨ Â· Made with â¤ï¸ Â· Material You Design</p>
        <p style="margin-top: 8px; font-size: 0.85rem;">ç‚¹å‡»ç”»å¸ƒä¸­çš„çˆ»å¯ä»¥åˆ‡æ¢é˜´é˜³</p>
    </footer>

    <script>
        // å¦å®«é…ç½®
        const palaces = {
            'ä¹¾': {
                element: 'é‡‘',
                hexagrams: ['ä¹¾ä¸ºå¤©', 'å¤©é£å§¤', 'å¤©å±±é', 'å¤©åœ°å¦', 'é£åœ°è§‚', 'å±±åœ°å‰¥', 'ç«åœ°æ™‹', 'ç«å¤©å¤§æœ‰']
            },
            'å': {
                element: 'æ°´',
                hexagrams: ['åä¸ºæ°´', 'æ°´æ³½èŠ‚', 'æ°´é›·å±¯', 'æ°´ç«æ—¢æµ', 'æ³½ç«é©', 'é›·ç«ä¸°', 'åœ°ç«æ˜å¤·', 'åœ°æ°´å¸ˆ']
            },
            'è‰®': {
                element: 'åœŸ',
                hexagrams: ['è‰®ä¸ºå±±', 'å±±ç«è´²', 'å±±å¤©å¤§ç•œ', 'å±±æ³½æŸ', 'ç«æ³½ç½', 'å¤©æ³½å±¥', 'é£æ³½ä¸­å­š', 'é£å±±æ¸']
            },
            'éœ‡': {
                element: 'æœ¨',
                hexagrams: ['éœ‡ä¸ºé›·', 'é›·åœ°è±«', 'é›·æ°´è§£', 'é›·é£æ’', 'åœ°é£å‡', 'æ°´é£äº•', 'æ³½é£å¤§è¿‡', 'æ³½é›·éš']
            },
            'å·½': {
                element: 'æœ¨',
                hexagrams: ['å·½ä¸ºé£', 'é£å¤©å°ç•œ', 'é£ç«å®¶äºº', 'é£é›·ç›Š', 'å¤©é›·æ— å¦„', 'ç«é›·å™¬å—‘', 'å±±é›·é¢', 'å±±é£è›Š']
            },
            'ç¦»': {
                element: 'ç«',
                hexagrams: ['ç¦»ä¸ºç«', 'ç«å±±æ—…', 'ç«é£é¼', 'ç«æ°´æœªæµ', 'å±±æ°´è’™', 'é£æ°´æ¶£', 'å¤©æ°´è®¼', 'å¤©ç«åŒäºº']
            },
            'å¤': {
                element: 'åœŸ',
                hexagrams: ['å¤ä¸ºåœ°', 'åœ°é›·å¤', 'åœ°æ³½ä¸´', 'åœ°å¤©æ³°', 'é›·å¤©å¤§å£®', 'æ³½å¤©å¤¬', 'æ°´å¤©éœ€', 'æ°´åœ°æ¯”']
            },
            'å…‘': {
                element: 'é‡‘',
                hexagrams: ['å…‘ä¸ºæ³½', 'æ³½æ°´å›°', 'æ³½åœ°èƒ', 'æ³½å±±å’¸', 'æ°´å±±è¹‡', 'åœ°å±±è°¦', 'é›·å±±å°è¿‡', 'é›·æ³½å½’å¦¹']
            }
        };

        // å¦è±¡ç¬¦å·æ˜ å°„
        const hexagramSymbols = {
            'ä¹¾ä¸ºå¤©': 'ä·€', 'å¤ä¸ºåœ°': 'ä·', 'æ°´é›·å±¯': 'ä·‚', 'å±±æ°´è’™': 'ä·ƒ',
            'æ°´å¤©éœ€': 'ä·„', 'å¤©æ°´è®¼': 'ä·…', 'åœ°æ°´å¸ˆ': 'ä·†', 'æ°´åœ°æ¯”': 'ä·‡',
            'é£å¤©å°ç•œ': 'ä·ˆ', 'å¤©æ³½å±¥': 'ä·‰', 'åœ°å¤©æ³°': 'ä·Š', 'å¤©åœ°å¦': 'ä·‹',
            'å¤©ç«åŒäºº': 'ä·Œ', 'ç«å¤©å¤§æœ‰': 'ä·', 'åœ°å±±è°¦': 'ä·', 'é›·åœ°è±«': 'ä·',
            'æ³½é›·éš': 'ä·', 'å±±é£è›Š': 'ä·‘', 'åœ°æ³½ä¸´': 'ä·’', 'é£åœ°è§‚': 'ä·“',
            'ç«é›·å™¬å—‘': 'ä·”', 'å±±ç«è´²': 'ä·•', 'å±±åœ°å‰¥': 'ä·–', 'åœ°é›·å¤': 'ä·—',
            'å¤©é›·æ— å¦„': 'ä·˜', 'å±±å¤©å¤§ç•œ': 'ä·™', 'å±±é›·é¢': 'ä·š', 'æ³½é£å¤§è¿‡': 'ä·›',
            'åä¸ºæ°´': 'ä·œ', 'ç¦»ä¸ºç«': 'ä·', 'æ³½å±±å’¸': 'ä·', 'é›·é£æ’': 'ä·Ÿ',
            'å¤©å±±é': 'ä· ', 'é›·å¤©å¤§å£®': 'ä·¡', 'ç«åœ°æ™‹': 'ä·¢', 'åœ°ç«æ˜å¤·': 'ä·£',
            'é£ç«å®¶äºº': 'ä·¤', 'ç«æ³½ç½': 'ä·¥', 'æ°´å±±è¹‡': 'ä·¦', 'é›·æ°´è§£': 'ä·§',
            'å±±æ³½æŸ': 'ä·¨', 'é£é›·ç›Š': 'ä·©', 'æ³½å¤©å¤¬': 'ä·ª', 'å¤©é£å§¤': 'ä·«',
            'æ³½åœ°èƒ': 'ä·¬', 'åœ°é£å‡': 'ä·­', 'æ³½æ°´å›°': 'ä·®', 'æ°´é£äº•': 'ä·¯',
            'æ³½ç«é©': 'ä·°', 'ç«é£é¼': 'ä·±', 'éœ‡ä¸ºé›·': 'ä·²', 'è‰®ä¸ºå±±': 'ä·³',
            'é£å±±æ¸': 'ä·´', 'é›·æ³½å½’å¦¹': 'ä·µ', 'é›·ç«ä¸°': 'ä·¶', 'ç«å±±æ—…': 'ä··',
            'å·½ä¸ºé£': 'ä·¸', 'å…‘ä¸ºæ³½': 'ä·¹', 'é£æ°´æ¶£': 'ä·º', 'æ°´æ³½èŠ‚': 'ä·»',
            'é£æ³½ä¸­å­š': 'ä·¼', 'é›·å±±å°è¿‡': 'ä·½', 'æ°´ç«æ—¢æµ': 'ä·¾', 'ç«æ°´æœªæµ': 'ä·¿'
        };

        // åœ°æ”¯é…ç½®ï¼ˆä»ä¸‹å¾€ä¸Šï¼‰
        const earthlyBranchesConfig = {
'111': ['å­', 'å¯…', 'è¾°', 'åˆ', 'ç”³', 'æˆŒ'], // ä¹¾/éœ‡
'001': ['å­', 'å¯…', 'è¾°', 'åˆ', 'ç”³', 'æˆŒ'],
'010': ['å¯…', 'è¾°', 'åˆ', 'ç”³', 'æˆŒ', 'å­'], // å
'100': ['è¾°', 'åˆ', 'ç”³', 'æˆŒ', 'å­', 'å¯…'], // è‰®
'000': ['æœª', 'å·³', 'å¯', 'ä¸‘', 'äº¥', 'é…‰'], // å¤
'011': ['å·³', 'å¯', 'ä¸‘', 'äº¥', 'é…‰', 'æœª'], // å…‘
'110': ['ä¸‘', 'äº¥', 'é…‰', 'æœª', 'å·³', 'å¯'], // å·½
'101': ['å¯', 'ä¸‘', 'äº¥', 'é…‰', 'æœª', 'å·³']  // ç¦»
        };

        // åœ°æ”¯äº”è¡Œ
        const branchElements = {
            'å­': 'æ°´', 'ä¸‘': 'åœŸ', 'å¯…': 'æœ¨', 'å¯': 'æœ¨', 'è¾°': 'åœŸ', 'å·³': 'ç«',
            'åˆ': 'ç«', 'æœª': 'åœŸ', 'ç”³': 'é‡‘', 'é…‰': 'é‡‘', 'æˆŒ': 'åœŸ', 'äº¥': 'æ°´'
        };

        // äº”è¡Œé¢œè‰²
        const wuxingColors = {
            'é‡‘': '#FFB74D',
            'æœ¨': '#66BB6A',
            'æ°´': '#42A5F5',
            'ç«': '#EF5350',
            'åœŸ': '#8D6E63'
        };

        // äº”è¡Œç”Ÿå…‹å…³ç³»
        function getLiuqin(branchElement, palaceElement) {
            const shengke = {
                'é‡‘': { sheng: 'æ°´', ke: 'æœ¨' },
                'æœ¨': { sheng: 'ç«', ke: 'åœŸ' },
                'æ°´': { sheng: 'æœ¨', ke: 'ç«' },
                'ç«': { sheng: 'åœŸ', ke: 'é‡‘' },
                'åœŸ': { sheng: 'é‡‘', ke: 'æ°´' }
            };

            if (branchElement === palaceElement) return 'å…„å¼Ÿ';
            if (shengke[palaceElement].sheng === branchElement) return 'å­å­™';
            if (shengke[branchElement].sheng === palaceElement) return 'çˆ¶æ¯';
            if (shengke[palaceElement].ke === branchElement) return 'å¦»è´¢';
            if (shengke[branchElement].ke === palaceElement) return 'å®˜é¬¼';
            
            return 'å…„å¼Ÿ';
        }

        // 64å¦æ•°æ®åº“
        const hexagramDatabase = {
            '111111': 'ä¹¾ä¸ºå¤©', '000000': 'å¤ä¸ºåœ°', '010001': 'æ°´é›·å±¯', '100010': 'å±±æ°´è’™',
            '010111': 'æ°´å¤©éœ€', '111010': 'å¤©æ°´è®¼', '000010': 'åœ°æ°´å¸ˆ', '010000': 'æ°´åœ°æ¯”',
            '110111': 'é£å¤©å°ç•œ', '111011': 'å¤©æ³½å±¥', '000111': 'åœ°å¤©æ³°', '111000': 'å¤©åœ°å¦',
            '111101': 'å¤©ç«åŒäºº', '101111': 'ç«å¤©å¤§æœ‰', '000100': 'åœ°å±±è°¦', '001000': 'é›·åœ°è±«',
            '011001': 'æ³½é›·éš', '100110': 'å±±é£è›Š', '000011': 'åœ°æ³½ä¸´', '110000': 'é£åœ°è§‚',
            '101001': 'ç«é›·å™¬å—‘', '100101': 'å±±ç«è´²', '100000': 'å±±åœ°å‰¥', '000001': 'åœ°é›·å¤',
            '111001': 'å¤©é›·æ— å¦„', '100111': 'å±±å¤©å¤§ç•œ', '100001': 'å±±é›·é¢', '011110': 'æ³½é£å¤§è¿‡',
            '010010': 'åä¸ºæ°´', '101101': 'ç¦»ä¸ºç«', '011100': 'æ³½å±±å’¸', '001110': 'é›·é£æ’',
            '111100': 'å¤©å±±é', '001111': 'é›·å¤©å¤§å£®', '101000': 'ç«åœ°æ™‹', '000101': 'åœ°ç«æ˜å¤·',
            '110101': 'é£ç«å®¶äºº', '101011': 'ç«æ³½ç½', '010100': 'æ°´å±±è¹‡', '001010': 'é›·æ°´è§£',
            '100011': 'å±±æ³½æŸ', '110001': 'é£é›·ç›Š', '011111': 'æ³½å¤©å¤¬', '111110': 'å¤©é£å§¤',
            '011000': 'æ³½åœ°èƒ', '000110': 'åœ°é£å‡', '011010': 'æ³½æ°´å›°', '010110': 'æ°´é£äº•',
            '011101': 'æ³½ç«é©', '101110': 'ç«é£é¼', '001001': 'éœ‡ä¸ºé›·', '100100': 'è‰®ä¸ºå±±',
            '110100': 'é£å±±æ¸', '001011': 'é›·æ³½å½’å¦¹', '001101': 'é›·ç«ä¸°', '101001': 'ç«å±±æ—…',
            '110110': 'å·½ä¸ºé£', '011011': 'å…‘ä¸ºæ³½', '110010': 'é£æ°´æ¶£', '010011': 'æ°´æ³½èŠ‚',
            '110011': 'é£æ³½ä¸­å­š', '001100': 'é›·å±±å°è¿‡', '010101': 'æ°´ç«æ—¢æµ', '101010': 'ç«æ°´æœªæµ'
        };

        // ç‰¹æ®Šå¦
        const specialHexagrams = {
            biyue: {
                'åœ°é›·å¤': 'å»ºå­ åä¸€æœˆ', 'åœ°æ³½ä¸´': 'å»ºä¸‘ åäºŒæœˆ', 'åœ°å¤©æ³°': 'å»ºå¯… æ­£æœˆ',
                'é›·å¤©å¤§å£®': 'å»ºå¯ äºŒæœˆ', 'æ³½å¤©å¤¬': 'å»ºè¾° ä¸‰æœˆ', 'ä¹¾ä¸ºå¤©': 'å»ºå·³ å››æœˆ',
                'å¤©é£å§¤': 'å»ºåˆ äº”æœˆ', 'å¤©å±±é': 'å»ºæœª å…­æœˆ', 'å¤©åœ°å¦': 'å»ºç”³ ä¸ƒæœˆ',
                'é£åœ°è§‚': 'å»ºé…‰ å…«æœˆ', 'å±±åœ°å‰¥': 'å»ºæˆŒ ä¹æœˆ', 'å¤ä¸ºåœ°': 'å»ºäº¥ åæœˆ'
            },
            liuhe: ['å¤©åœ°å¦', 'åœ°å¤©æ³°', 'åœ°é›·å¤', 'é›·åœ°è±«', 'å±±ç«è´²', 'ç«å±±æ—…', 'æ³½æ°´å›°', 'æ°´æ³½èŠ‚'],
            liuchong: ['ä¹¾ä¸ºå¤©', 'å…‘ä¸ºæ³½', 'ç¦»ä¸ºç«', 'éœ‡ä¸ºé›·', 'å·½ä¸ºé£', 'åä¸ºæ°´', 'è‰®ä¸ºå±±', 'å¤ä¸ºåœ°', 'å¤©é›·æ— å¦„', 'é›·å¤©å¤§å£®']
        };

        let currentLines = [1,1,1,1,1,1];
        let lineColors = Array(6).fill('#6750A4');
        let canvas, ctx;
        let currentSymbol = 'ä·€';

        function init() {
            canvas = document.getElementById('hexagramCanvas');
            ctx = canvas.getContext('2d');
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton();
            
            renderLineColorControls();
            updateCanvas();
            canvas.addEventListener('click', handleCanvasClick);
        }

        function getHexagramName(lines) {
            const key = [lines[5], lines[4], lines[3], lines[2], lines[1], lines[0]].join('');
            return hexagramDatabase[key] || 'æœªçŸ¥å¦';
        }

        function getPalaceInfo(hexagramName) {
            for (const [palace, data] of Object.entries(palaces)) {
                const index = data.hexagrams.indexOf(hexagramName);
                if (index !== -1) {
                    let shi;
                    if (index === 0) shi = 5;
                    else if (index >= 1 && index <= 5) shi = index - 1;
                    else if (index === 6) shi = 3;
                    else if (index === 7) shi = 2;
                    
                    const ying = (shi + 3) % 6;
                    
                    return {
                        palace: palace + 'å®«',
                        palaceName: palace,
                        element: data.element,
                        shi,
                        ying,
                        isYouhun: index === 6,
                        isGuihun: index === 7,
                        isBengong: index === 0
                    };
                }
            }
            return null;
        }

        function getEarthlyBranches(lines) {
            // ä¸‹å¦ä¸‰çˆ»ï¼šlines[0], lines[1], lines[2]
            // ä¸Šå¦ä¸‰çˆ»ï¼šlines[3], lines[4], lines[5]
            const lowerKey = [lines[2], lines[1], lines[0]].join(''); // ä»ä¸Šå¾€ä¸‹è¯»
            const upperKey = [lines[5], lines[4], lines[3]].join('');
            
            const lowerBranches = earthlyBranchesConfig[lowerKey] || [];
            const upperBranches = earthlyBranchesConfig[upperKey] || [];
            
            // è¿”å›ä»ä¸‹å¾€ä¸Šçš„åœ°æ”¯ï¼ˆåˆçˆ»åˆ°ä¸Šçˆ»ï¼‰
            return [
                lowerBranches[0] || '', // åˆçˆ»
                lowerBranches[1] || '', // äºŒçˆ»
                lowerBranches[2] || '', // ä¸‰çˆ»
                upperBranches[3] || '', // å››çˆ»
                upperBranches[4] || '', // äº”çˆ»
                upperBranches[5] || ''  // ä¸Šçˆ»
            ];
        }

        function getLiuqinForHexagram(hexagramName, branches) {
            const palaceInfo = getPalaceInfo(hexagramName);
            if (!palaceInfo) return { liuqins: Array(6).fill(''), missingInfo: [] };
            
            const palaceElement = palaceInfo.element;
            const liuqins = branches.map(branch => {
                if (!branch) return '';
                const branchElement = branchElements[branch];
                return getLiuqin(branchElement, palaceElement);
            });

            const required = ['çˆ¶æ¯', 'å…„å¼Ÿ', 'å®˜é¬¼', 'å¦»è´¢', 'å­å­™'];
            const missing = required.filter(lq => !liuqins.includes(lq));
            
            const missingInfo = {};
            if (missing.length > 0) {
                const bengongName = palaces[palaceInfo.palaceName].hexagrams[0];
                const bengongKey = Object.entries(hexagramDatabase).find(([k, v]) => v === bengongName)?.[0];
                
                if (bengongKey) {
                    const bengongLines = bengongKey.split('').map(Number);
                    const bengongBranches = getEarthlyBranches(bengongLines);
                    const bengongLiuqins = bengongBranches.map(branch => {
                        const branchElement = branchElements[branch];
                        return getLiuqin(branchElement, palaceElement);
                    });
                    
                    missing.forEach(lq => {
                        const idx = bengongLiuqins.indexOf(lq);
                        if (idx !== -1) {
                            // æ‰¾åˆ°å½“å‰å¦ä¸­é‡å¤æœ€å¤šçš„å…­äº²å¯¹åº”çš„çˆ»ä½
                            const counts = {};
                            liuqins.forEach((l, i) => {
                                if (l) counts[l] = (counts[l] || []).concat(i);
                            });
                            const maxCount = Math.max(...Object.values(counts).map(arr => arr.length));
                            const mostCommon = Object.entries(counts).find(([k, v]) => v.length === maxCount);
                            
                            if (mostCommon && mostCommon[1].length > 1) {
                                // æ˜¾ç¤ºåœ¨ç¬¬ä¸€ä¸ªé‡å¤çš„çˆ»ä½
                                const targetIdx = mostCommon[1][0];
                                missingInfo[targetIdx] = `${bengongBranches[idx]} ${lq}`;
                            }
                        }
                    });
                }
            }
            
            return { liuqins, missingInfo };
        }

        function checkSpecialHexagram(hexagramName, palaceInfo) {
            const tags = [];
            
            if (palaceInfo?.isYouhun) tags.push({ type: 'youhun', text: 'æ¸¸é­‚å¦' });
            if (palaceInfo?.isGuihun) tags.push({ type: 'guihun', text: 'å½’é­‚å¦' });
            if (palaceInfo?.isBengong) tags.push({ type: 'bengong', text: 'æœ¬å®«å¦' });
            if (specialHexagrams.biyue[hexagramName]) {
                tags.push({ type: 'biyue', text: 'è¾Ÿå¦ ' + specialHexagrams.biyue[hexagramName] });
            }
            if (specialHexagrams.liuhe.includes(hexagramName)) tags.push({ type: 'liuhe', text: 'å…­åˆå¦' });
            if (specialHexagrams.liuchong.includes(hexagramName)) tags.push({ type: 'liuchong', text: 'å…­å†²å¦' });
            
            return tags;
        }

        function updateHexagramInfo() {
            const hexagramName = getHexagramName(currentLines);
            const palaceInfo = getPalaceInfo(hexagramName);
            const specialTags = checkSpecialHexagram(hexagramName, palaceInfo);
            const showSpecial = document.getElementById('showSpecialTags').checked;
            const symbol = hexagramSymbols[hexagramName] || '?';
            currentSymbol = symbol;
            
            let html = `
                <div class="info-row">
                    <span class="info-label">å¦è±¡ç¬¦å·ï¼š</span>
                    <span class="symbol-text">${symbol}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">å¦åï¼š</span>
                    <span class="info-value">${hexagramName}</span>
                </div>
            `;
            
            if (palaceInfo) {
                html += `
                    <div class="info-row">
                        <span class="info-label">å¦å®«ï¼š</span>
                        <span class="info-value">${palaceInfo.palace}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">äº”è¡Œï¼š</span>
                        <span class="info-value">${palaceInfo.element}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ä¸–åº”ï¼š</span>
                        <span class="info-value">ä¸–${palaceInfo.shi + 1} åº”${palaceInfo.ying + 1}</span>
                    </div>
                `;
            }
            
            if (showSpecial && specialTags.length > 0) {
                html += `
                    <div class="info-row" style="flex-direction: column; align-items: flex-start;">
                        <span class="info-label" style="margin-bottom: 8px;">ç‰¹æ®Šå±æ€§ï¼š</span>
                        <div class="special-tags">
                            ${specialTags.map(tag => `<span class="tag tag-${tag.type}">${tag.text}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('hexagramInfo').innerHTML = html;
        }

        function copySymbol() {
            navigator.clipboard.writeText(currentSymbol).then(() => {
                const buttons = document.querySelectorAll('.btn-primary');
                const btn = buttons[0];
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ“ å·²å¤åˆ¶';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function renderLineColorControls() {
            const container = document.getElementById('lineColors');
            const lineNames = ['åˆçˆ»', 'äºŒçˆ»', 'ä¸‰çˆ»', 'å››çˆ»', 'äº”çˆ»', 'ä¸Šçˆ»'];
            
            container.innerHTML = lineNames.map((name, i) => `
                <div class="line-control">
                    <span class="line-label">${name}</span>
                    <input type="color" value="${lineColors[i]}" onchange="updateLineColor(${i}, this.value)">
                    <span class="color-value">${lineColors[i]}</span>
                </div>
            `).join('');
        }

        function updateLineColor(index, color) {
            lineColors[index] = color;
            document.querySelectorAll('.color-value')[index].textContent = color;
            updateCanvas();
        }

        function resetColors() {
            const defaultColor = getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-primary').trim();
            lineColors = Array(6).fill(defaultColor);
            
            document.querySelectorAll('#lineColors input[type="color"]').forEach((input, i) => {
                input.value = defaultColor;
            });
            document.querySelectorAll('.color-value').forEach((span, i) => {
                span.textContent = defaultColor;
            });
            
            updateCanvas();
        }

        function updateCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const baseWidth = window.innerWidth < 768 ? 500 : 700;
            const width = baseWidth;
            const height = 900;
            
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
            
            ctx.scale(dpr, dpr);
            ctx.clearRect(0, 0, width, height);
            
            const showName = document.getElementById('showName').checked;
            const showBranches = document.getElementById('showEarthlyBranches').checked;
            const showShiYing = document.getElementById('showShiYing').checked;
            const showPalace = document.getElementById('showPalace').checked;
            const showWuxing = document.getElementById('showWuxing').checked;
            const showLiuqin = document.getElementById('showLiuqin').checked;
            const useWuxingColors = document.getElementById('useWuxingColors').checked;
            
            const hexagramName = getHexagramName(currentLines);
            const palaceInfo = getPalaceInfo(hexagramName);
            const earthlyBranches = getEarthlyBranches(currentLines);
            const liuqinData = getLiuqinForHexagram(hexagramName, earthlyBranches);
            
            updateHexagramInfo();
            
            let yOffset = 80;
            if (showName) {
                ctx.font = 'bold 36px "Noto Serif SC", serif';
                ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
                ctx.textAlign = 'center';
                ctx.fillText(hexagramName, width / 2, yOffset);
                yOffset += 50;
                
                if (showPalace && palaceInfo) {
                    ctx.font = '22px "Noto Serif SC", serif';
                    let palaceText = `ã€${palaceInfo.palace}ã€‘`;
                    if (showWuxing) palaceText += ` ${palaceInfo.element}`;
                    
                    if (useWuxingColors) {
                        ctx.fillStyle = wuxingColors[palaceInfo.element];
                    } else {
                        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-primary').trim();
                    }
                    ctx.fillText(palaceText, width / 2, yOffset);
                    yOffset += 50;
                }
            } else {
                yOffset = 40;
            }
            
            const lineHeight = 30, lineGap = 70;
            const lineWidth = window.innerWidth < 768 ? 250 : 300;
            const gapWidth = 60;
            
            for (let i = 0; i < 6; i++) {
                const y = yOffset + (5 - i) * (lineHeight + lineGap);
                const isYang = currentLines[i] === 1;
                
                ctx.strokeStyle = lineColors[i];
                ctx.lineWidth = lineHeight;
                ctx.lineCap = 'round';
                
                if (isYang) {
                    ctx.beginPath();
                    ctx.moveTo((width - lineWidth) / 2, y);
                    ctx.lineTo((width + lineWidth) / 2, y);
                    ctx.stroke();
                } else {
                    ctx.beginPath();
                    ctx.moveTo((width - lineWidth) / 2, y);
                    ctx.lineTo((width - gapWidth) / 2, y);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo((width + gapWidth) / 2, y);
                    ctx.lineTo((width + lineWidth) / 2, y);
                    ctx.stroke();
                }
                
                // å³ä¾§ï¼šåœ°æ”¯å’Œå…­äº²
                let rightText = '';
                const fontSize = window.innerWidth < 768 ? 18 : 22;
                
                if (showBranches && earthlyBranches[i]) {
                    rightText = earthlyBranches[i];
                }
                if (showLiuqin && liuqinData.liuqins[i]) {
                    rightText += ' ' + liuqinData.liuqins[i];
                }
                
                // æ˜¾ç¤ºä¼ç¥ï¼ˆåœ¨é‡å¤çš„å…­äº²æ—è¾¹ï¼‰
                if (showLiuqin && liuqinData.missingInfo[i]) {
                    rightText += ' (ä¼ç¥ï¼š' + liuqinData.missingInfo[i] + ')';
                }
                
                if (rightText) {
                    ctx.font = `bold ${fontSize}px "Noto Serif SC", serif`;
                    
                    if (useWuxingColors && earthlyBranches[i]) {
                        const branchElement = branchElements[earthlyBranches[i]];
                        ctx.fillStyle = wuxingColors[branchElement];
                    } else {
                        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-color').trim();
                    }
                    
                    ctx.textAlign = 'left';
                    ctx.fillText(rightText, (width + lineWidth) / 2 + 40, y + 10);
                }
                
                // å·¦ä¾§ï¼šä¸–åº”
                if (showShiYing && palaceInfo) {
                    ctx.font = `bold ${fontSize + 4}px "Noto Serif SC", serif`;
                    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--md-sys-color-tertiary').trim();
                    ctx.textAlign = 'right';
                    
                    if (i === palaceInfo.shi) ctx.fillText('ä¸–', (width - lineWidth) / 2 - 40, y + 10);
                    if (i === palaceInfo.ying) ctx.fillText('åº”', (width - lineWidth) / 2 - 40, y + 10);
                }
            }
        }

        function handleCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const y = event.clientY - rect.top;
            
            const showName = document.getElementById('showName').checked;
            const showPalace = document.getElementById('showPalace').checked;
            
            let yOffset = showName ? (showPalace ? 180 : 130) : 40;
            
            const lineHeight = 30, lineGap = 70;
            
            for (let i = 0; i < 6; i++) {
                const lineY = yOffset + (5 - i) * (lineHeight + lineGap);
                if (Math.abs(y - lineY) < lineHeight + 25) {
                    currentLines[i] = currentLines[i] === 1 ? 0 : 1;
                    canvas.classList.add('line-toggling');
                    setTimeout(() => canvas.classList.remove('line-toggling'), 300);
                    updateCanvas();
                    break;
                }
            }
        }

        function downloadPNG() {
            const hexagramName = getHexagramName(currentLines);
            const link = document.createElement('a');
            link.download = `${hexagramName}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton();
            resetColors();
        }

        function updateThemeButton() {
            const theme = document.documentElement.getAttribute('data-theme');
            document.getElementById('themeIcon').textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            document.getElementById('themeText').textContent = theme === 'dark' ? 'æµ…è‰²æ¨¡å¼' : 'æ·±è‰²æ¨¡å¼';
        }

        window.addEventListener('DOMContentLoaded', init);
        window.addEventListener('resize', updateCanvas);
    </script>
</body>
</html>
